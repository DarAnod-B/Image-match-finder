Скрипт предназначенный для сравнения двух групп изображений и поиска семантических дубликатов. Основной сценарий использования — поиск "чистых" версий изображений (`Group 2`), которые соответствуют версиям с водяными знаками (`Group 1`).

Инструмент способен  определять, что два изображения являются одной и той же сценой, даже при наличии значительных искажений, таких как:
*   Большие и непрозрачные водяные знаки (watermarks).
*   Изменения в яркости, контрастности и цветовой гамме.
*   Небольшие изменения в кадрировании или разрешении.
*   Артефакты сжатия (JPEG).

По итогам работы скрипт формирует финальный список изображений, где каждая картинка из первой группы заменена на свой "чистый" аналог из второй, если таковой был найден.

## Ключевые технологии

В основе инструмента лежит гибридный подход, сочетающий скорость классического компьютерного зрения и надежность геометрической верификации:

1.  **ORB (Oriented FAST and Rotated BRIEF):** Быстрый и эффективный алгоритм для нахождения тысяч уникальных "ключевых точек" (углов, текстур) на каждом изображении и создания их цифровых "отпечатков" — дескрипторов.
2.  **Brute-Force Matcher с фильтром Лоу:** Надежный метод для поиска наилучших совпадений между дескрипторами двух изображений. Фильтр Лоу (Lowe's Ratio Test) отсеивает неоднозначные и слабые совпадения, значительно повышая качество.
3.  **RANSAC (Random Sample Consensus):** Мощный алгоритм для **геометрической верификации**. Он проверяет, подчиняются ли найденные совпадения единой геометрической трансформации (поворот, масштаб, сдвиг). Это позволяет отличать настоящие совпадения от случайных, которые часто возникают на похожих, но разных изображениях (например, две разные комнаты в одном стиле).
4.  **Кэширование дескрипторов:** Для повышения производительности при работе с большими коллекциями изображений, инструмент предварительно обрабатывает базовую группу (`Group 2`) и сохраняет их дескрипторы в бинарный кэш-файл (`.pkl`). Это позволяет избежать повторных вычислений при каждом запуске.

## Структура проекта

```
image-match-finder/
├── core/
│   ├── cacher.py         # Логика создания кэша дескрипторов
│   ├── searcher.py       # Логика поиска по кэшу и сравнения
│   └── utils.py          # Вспомогательные функции (валидация, ресайз)
│
├── settings.py             # Центральный файл конфигурации (пути, пороги)
├── logger.py             # Настройка логгирования
├── main.py               # Главный исполняемый файл (точка входа)
└── requirements.txt      # Список зависимостей проекта
```

## Установка

Для работы инструмента требуется Python 3.8 или выше.

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/DarAnod-B/Image-match-finder.git
    cd image-match-finder
    ```

2.  **Создайте и активируйте виртуальное окружение (рекомендуется):**
    ```bash
    # Создать окружение
    python -m venv venv

    # Активировать в Windows
    .\venv\Scripts\activate

    # Активировать в macOS/Linux
    source venv/bin/activate
    ```

3.  **Установите все необходимые зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

## Конфигурация

Все основные параметры настраиваются в файле `settings.py`.

```python
# settings.py

# --- ПУТИ К ДАННЫМ ---
# Путь к папке с изображениями для поиска (например, с водяными знаками)
GROUP_1_DIR = r"C:\path\to\your\watermarked_images"

# Путь к папке с базой изображений для сравнения (например, чистые)
GROUP_2_DIR = r"C:\path\to\your\clean_images_database"

# Путь к файлу кэша. Он будет создан автоматически.
DESCRIPTORS_CACHE_PATH = "descriptors_cache.pkl"


# --- ТЕХНИЧЕСКИЕ ПАРАМЕТРЫ ---
# Стандартный размер, к которому приводятся изображения для анализа
RESIZE_WIDTH = 800
RESIZE_HEIGHT = 800

# Количество ключевых точек, которые ORB будет пытаться найти на каждом изображении
ORB_N_FEATURES = 2000

# Минимальное количество геометрически согласованных точек (inliers),
# найденных RANSAC, для финального подтверждения сходства.
# Это главный параметр, влияющий на точность.
RANSAC_MIN_INLIERS = 15
```

**Перед первым запуском обязательно укажите правильные пути в `GROUP_1_DIR` и `GROUP_2_DIR`!**

## Использование

Запуск скрипта производится из корневой директории проекта через файл `main.py`.

```bash
python main.py
```